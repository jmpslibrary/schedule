<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Commons Booking</title>
    <!-- Tailwind CSS CDN -->
    <link href="dist/output.css" rel="stylesheet">

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
   
    <style>
        html {
            font-size: 18px;
        }

        /* Custom styles for mobile optimization */
        @media (max-width: 640px) {
            html {
                font-size: 16px;
            }
            .controls-container .nav-button { display: none; }
            
            .schedule-grid .grid-header:not(.current-day-header):not(:first-child),
            .schedule-grid .grid-cell:not(.current-day) { display: none; }
            .schedule-grid { grid-template-columns: auto 1fr !important; gap: 8px !important; }
            .grid-cell { min-height: 70px !important; padding: 14px !important; font-size: 16px !important; }
            .grid-header { padding: 14px !important; font-size: 18px !important; }
            .grid-label { padding: 14px 10px !important; font-size: 16px !important; min-width: 100px; }
            .period-time { font-size: 13px !important; }
            .booking-actions { gap: 6px !important; }
            .booking-actions .material-symbols-outlined { font-size: 22px !important; }
            .no-current-day-mobile { grid-column: 1 / -1; text-align: center; padding: 24px; background-color: #f9fafb; color: #6b7280; font-size: 18px; margin: 24px 0; border-radius: 16px; border: 2px dashed #d1d5db; }
        }
        @media (min-width: 641px) {
            .no-current-day-mobile, .mobile-day-info { display: none !important; }
            .booking-actions { gap: 6px !important; }
            /* Increased grid cell sizing for desktop */
            .grid-cell { min-height: 80px !important; padding: 18px !important; font-size: 16px !important; }
            .grid-header { padding: 18px !important; font-size: 18px !important; }
            .grid-label { padding: 18px 12px !important; font-size: 16px !important; min-width: 120px; }
            .period-time { font-size: 14px !important; }
        }
        .schedule-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .schedule-grid { min-width: 400px; gap: 8px; }
        @layer utilities {
            input[type="date"]::-webkit-calendar-picker-indicator { opacity: 0; cursor: pointer; }
            input[type="date"]::-moz-calendar-picker-indicator { opacity: 0; cursor: pointer; }
            .date-picker-wrapper .date-picker-icon { right: 8px; pointer-events: none; }
        }
        .grid-cell.available {
            border-radius: 10px; /* Slightly larger border radius */
        }

        .grid-cell.available:hover {
            /* A slightly darker gradient for the hover state */
            background-image: linear-gradient(to bottom, #dcfce7, #bbf7d0);
            transform: translateY(-2px); /* A nice lift effect on hover */
            box-shadow: 0 6px 12px rgba(0,0,0,0.08); /* Slightly larger shadow */
        }

        .btn-large {
            padding: 12px 20px !important;
            font-size: 16px !important;
        }

        #delete-booking-btn.btn-large {
            padding: 12px 16px !important;
        }

        #delete-booking-btn .material-symbols-outlined {
            vertical-align: middle;
            line-height: 1; /* keeps it tighter */
        }
        
        .input-large {
            padding: 12px 16px !important;
            font-size: 16px !important;
        }

    .site-footer {
        /* This matches the width and centering of your main content */
        max-width: 80rem; /* 80rem is the equivalent of Tailwind's max-w-7xl */
        margin-left: auto;
        margin-right: auto;

        /* This adds the border and spacing */
        border-top: 1px solid #e5e7eb; /* This is a light gray, similar to Tailwind's gray-200 */
        padding-top: 0.5rem;    /* Adds space above the text */
        padding-bottom: 2rem; /* Adds space below the text */
        padding-left: 1rem;   /* Adds space on the sides */
        margin-top: 1rem;     /* Adds space between the schedule and the footer */
    }

    .site-footer p {
        /* This styles and aligns the text */
        text-align: right;
        font-size: 0.775rem; /* Small text, like Tailwind's text-sm */
        color: #6b7280;     /* Muted gray color, like Tailwind's gray-500 */
    }

    .school-name {
        letter-spacing: 1.8px;
        font-size: 0.75em;
        line-height: 0.55rem;
        padding-top: 10px;
    }
    
    </style>
</head>
<body class="bg-gray-50 font-sans p-3 sm:p-6 md:p-10">
    <div class="max-w-7xl mx-auto">

        <p class="school-name uppercase sm:hidden text-center text-sm text-gray-500">Jack Miner Public School</p>

        <header class="flex flex-col sm:flex-row justify-between items-center mb-4 sm:mb-6">
            <!-- This new div groups the logo and title together -->
            <div class="flex items-center gap-3 sm:gap-4">
                <img src="logo.png" alt="Jack Miner Nighthawks Logo" class="hidden sm:block h-12 sm:h-16 w-auto">
                <h1 class="text-2xl font-bold tracking-tighter mb-2 sm:text-3xl text-gray-800 mb-0">Learning Commons Booking</h1>
            </div>

            <div id="auth-container">
                <div id="user-info" class="hidden items-center gap-2 sm:gap-4 text-center">
                    <span class="text-sm sm:text-base text-gray-700">Welcome, <span id="user-name" class="font-semibold"></span>!</span>
                    <button id="admin-btn" title="Admin Panel" class="hidden p-1.5 rounded-full hover:bg-gray-200">
                        <span class="material-symbols-outlined text-gray-600 align-middle">settings</span>
                    </button>
                    <button id="logout-btn" class="px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Logout</button>
                </div>
                <button id="login-btn" class="px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Sign in with Google</button>
            </div>
        </header>

            <div id="app-content" class="hidden">
            <!-- Controls -->
            <div class="controls-container flex flex-col sm:flex-row items-center justify-between sm:gap-6 mb-4 p-3 sm:p-4 bg-white border border-gray-200 rounded-lg shadow-sm">
                
                <!-- Date Picker (left side) -->
                <div class="date-picker-wrapper relative flex items-center flex-1 sm:flex-none">
                <label for="date-picker" class="text-sm font-medium text-gray-700 mr-2 whitespace-nowrap">Date:</label>
                <input type="date" id="date-picker" class="flex-1 sm:w-40 h-10 pl-3 pr-3 border border-gray-300 rounded-md text-gray-800 focus:ring-blue-500 focus:border-blue-500 text-sm">
                <span class="material-symbols-outlined date-picker-icon absolute right-3 text-gray-500 pointer-events-none">calendar_month</span>
                </div>
                
                <!-- Navigation buttons (right side) -->
                <div class="flex items-center gap-3 sm:gap-4">
                <button id="prev-week-btn" 
                    class="nav-button flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="material-symbols-outlined text-lg">arrow_back</span>
                    <span class="hidden sm:inline">Prev Week</span>
                </button>
                
                <button id="next-week-btn" 
                    class="nav-button flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="hidden sm:inline">Next Week</span>
                    <span class="material-symbols-outlined text-lg">arrow_forward</span>
                </button>
                </div>
                
            </div>
            </div>
        
            <!-- Mobile day indicator and navigation -->
            <div id="mobile-day-info" class="mobile-day-info hidden sm:hidden mb-5 p-4 bg-gray-100 border border-gray-200 rounded-lg">
                <div class="flex items-center justify-between">
                    <div class="text-base text-gray-600">
                        <span class="font-semibold" id="mobile-current-day-info">Select a date to view schedule</span>
                    </div>
                    <div class="flex gap-3"> <!-- Increased gap -->
                        <button id="mobile-prev-day" class="p-3 text-gray-600 hover:bg-gray-100 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-xl">arrow_left_alt</span>
                        </button>
                        <button id="mobile-next-day" class="p-3 text-gray-600 hover:bg-gray-100 rounded-full disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-xl">arrow_right_alt</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- NEW: Alert Banner Container -->
            <div id="alert-banner" class="hidden bg-gradient-to-br from-yellow-400 to-yellow-200 border-l-4 border-b border-red-500 text-yellow-800 p-5 mb-5 rounded-md shadow-sm" role="alert">
                <!-- Banner content will be inserted here by JS -->
            </div>
            
            <div id="info-banner" class="hidden p-4 sm:p-5 mb-5 sm:mb-7 text-center rounded-md text-base"></div>
            
            <!-- No current day message for mobile -->
            <div id="no-current-day-mobile" class="no-current-day-mobile hidden">
                <span class="material-symbols-outlined text-gray-400 text-3xl mb-3 block">event_busy</span>
                <p class="text-lg">Select a school day to view and book library periods</p>
            </div>
            
            <!-- Scrollable schedule container for mobile -->
            <div class="schedule-wrapper">
                <div id="schedule-grid" class="schedule-grid grid" style="grid-template-columns: auto repeat(5, 1fr);"></div>
            </div>
        </div>
    </div>
    
    <!--
    <footer class="site-footer">
        <p class="tracking-tight">jmpslibrary.github.io/schedule</p>
    </footer>
    -->

    <!-- Mobile-optimized Booking Modal -->
    <div id="booking-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50 p-4 sm:p-0">
        <div class="modal-content bg-white p-5 sm:p-7 rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <h2 id="modal-title" class="text-xl sm:text-2xl font-semibold mb-5 text-gray-800 leading-tight"></h2>
            <form id="booking-form" class="flex flex-col gap-4 sm:gap-5">
                <div>
                    <label for="teacher-name" class="block text-base font-medium text-gray-700 mb-2">Your Name:</label>
                    <input type="text" id="teacher-name" required class="input-large w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <!-- NEW: Start Period Dropdown (for editing) -->
                <div id="start-period-container" class="hidden">
                    <label for="start-period" class="block text-base font-medium text-gray-700 mb-2">Start Period:</label>
                    <select id="start-period" class="input-large w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white">
                        <!-- Options will be added by JavaScript -->
                    </select>
                </div>

                <div>
                    <label for="end-period" class="block text-base font-medium text-gray-700 mb-2">End Period:</label>
                    <select id="end-period" required class="input-large w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white">
                        <!-- Options will be added by JavaScript -->
                    </select>
                </div>

                <div>
                    <label class="block text-base font-medium text-gray-700 mb-3">Booking for:</label>
                    <div id="booking-reason-options" class="flex flex-col gap-2 max-h-36 overflow-y-auto"></div>
                </div>
                
                <input type="text" id="other-reason" placeholder="Please specify" class="input-large w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 hidden">

                <div class="modal-buttons flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 mt-4">
                    <!-- NEW: Delete button, hidden by default -->
                    <button type="button" id="delete-booking-btn" class="hidden btn-large order-4 sm:order-1 sm:mr-auto px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        <span class="material-symbols-outlined">delete</span>
                    </button>

                    <button type="button" id="cancel-booking-btn" class="order-3 sm:order-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="order-2 sm:order-3 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 book">Book Slot</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW: Admin Panel Modal -->
    <div id="admin-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
        <div class="modal-content bg-white p-5 sm:p-7 rounded-lg shadow-xl w-full max-w-lg">
            <h2 class="text-xl sm:text-2xl font-semibold mb-5 text-gray-800">Admin Panel - Alert Banner</h2>
            <form id="admin-form" class="flex flex-col gap-5"> <!-- Increased gap -->
                <div>
                    <label for="banner-message" class="block text-base font-medium text-gray-700 mb-2">Banner Message:</label>
                    <textarea id="banner-message" rows="4" placeholder="e.g., The library will be closed on Friday..." class="input-large w-full border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                <div>
                    <label for="banner-expiry" class="block text-base font-medium text-gray-700 mb-2">Expiry Date and Time:</label>
                    <input type="datetime-local" id="banner-expiry" class="input-large w-full border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="modal-buttons flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 mt-5">
                    <button type="button" id="delete-banner-btn" class="btn-large order-3 sm:order-1 sm:mr-auto px-5 py-3 font-medium text-red-700 bg-red-100 rounded-md hover:bg-red-200">Delete Banner</button>
                    <button type="button" id="cancel-admin-btn" class="btn-large order-2 sm:order-2 px-5 py-3 font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Close</button>
                    <button type="submit" class="btn-large order-1 sm:order-3 px-5 py-3 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">Save Banner</button>
                </div>
            </form>
        </div>
    </div>

<div id="confirm-delete-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50 p-4 sm:p-0">
    <!-- THIS IS THE CHANGE: max-w-lg to match the other modal -->
    <div class="modal-content bg-white p-5 sm:p-7 rounded-lg shadow-xl w-full max-w-lg">
        <!-- THIS IS THE CHANGE: New header section -->
        <div class="flex items-center gap-3 mb-5">
            <span class="material-symbols-outlined text-3xl text-red-600">delete_forever</span>
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">Confirm Deletion</h2>
        </div>

        <p class="text-gray-600 mb-6 pl-1">Are you sure you want to cancel this booking? This action cannot be undone.</p>
        
        <div class="modal-buttons flex flex-col sm:flex-row justify-end gap-3 sm:gap-4 mt-5">
            <button id="cancel-delete-btn" class="btn-large order-2 sm:order-1 px-5 py-3 font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Cancel</button>
            <button id="confirm-delete-btn" class="btn-large order-1 sm:order-2 px-5 py-3 font-medium text-white bg-red-600 rounded-md hover:bg-red-700">Yes, Cancel Booking</button>
        </div>
    </div>
</div>

    <script src="script.js"></script>

</body>
</html>